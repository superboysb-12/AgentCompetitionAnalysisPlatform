# 三元组质量评估可视化功能说明

## 📊 新增功能概览

为质量评估模块添加了完整的可视化功能，包括：
- **5种精美图表**：柱状图、雷达图、质量分布图、散点图、热力图
- **Excel表格导出**：3个sheet的详细数据对比
- **自动集成**：运行评估自动生成图表
- **独立工具**：可单独运行可视化脚本

---

## 🎨 可视化图表详解

### 1. 对比柱状图 (`quality_comparison_bars_*.png`)
**用途**: 直观对比不同知识图谱的三个核心指标

**特点**:
- 并排对比：证据支持度、稳健一致性、综合质量
- 数值标签：每个柱子上方显示精确数值
- 色彩区分：蓝色（支持度）、绿色（一致性）、红色（综合质量）

**适用场景**: 快速识别最佳模型，了解各维度表现

---

### 2. 雷达图 (`quality_radar_*.png`)
**用途**: 展示各知识图谱的全方位性能轮廓

**特点**:
- 三维展示：证据支持度、稳健一致性、综合质量
- 填充效果：直观显示性能覆盖范围
- 多模型叠加：一图对比所有知识图谱

**适用场景**: 识别各模型的优势和短板

---

### 3. 质量分布图 (`quality_distribution_*.png`)
**用途**: 分析三元组质量等级分布

**特点**:
- 三级分类：高质量(≥0.7)、中等质量(0.4-0.7)、低质量(<0.4)
- 双重标注：显示数量和百分比
- 分图展示：每个知识图谱独立柱状图

**适用场景**: 质量把关，识别需要过滤的低质量数据

---

### 4. 散点图 (`quality_scatter_*.png`)
**用途**: 探索支持度与一致性的关系

**特点**:
- 二维展示：X轴=证据支持度，Y轴=稳健一致性
- 气泡大小：代表三元组数量
- 对角线参考：理想情况下应靠近对角线
- 标签标注：每个点都有知识图谱名称

**适用场景**: 发现异常模型（高支持度但低一致性，或反之）

---

### 5. 热力图 (`quality_heatmap_*.png`)
**用途**: 直观展示所有指标的评分矩阵

**特点**:
- 色彩编码：红绿渐变（绿色=高分，红色=低分）
- 精确数值：每个单元格显示评分
- 矩阵布局：知识图谱×评估指标

**适用场景**: 全面对比，快速定位优劣势

---

## 📈 Excel表格导出

### 文件：`quality_comparison_*.xlsx`

包含3个工作表：

#### Sheet 1: 综合对比
| 知识图谱 | 证据支持度 | 稳健一致性 | 综合质量 | 三元组总数 | 高质量数量 | 中等质量数量 | 低质量数量 |
|---------|-----------|-----------|---------|-----------|-----------|-------------|-----------|
| deepseek | 0.785 | 0.856 | 0.814 | 1234 | 890 | 300 | 44 |
| ... | ... | ... | ... | ... | ... | ... | ... |

#### Sheet 2: 详细统计
包含每个指标的完整统计：平均值、标准差、最小值、最大值、中位数

#### Sheet 3: 质量分布
高中低质量三元组的数量和占比

---

## 🚀 使用方式

### 方式1：自动生成（推荐）
```bash
cd LLMRelationExtracter
python scripts/quality_check/run_quality_check.py
```

评估完成后，自动生成：
- ✓ JSON/Markdown报告
- ✓ 5个可视化图表
- ✓ Excel表格

### 方式2：单独生成可视化
```bash
cd LLMRelationExtracter
python scripts/quality_check/visualize_quality.py
```

会自动使用最新的评估报告生成图表。

---

## 📦 依赖安装

**完整依赖（推荐）：**
```bash
pip install -r requirements.txt
```

**最小依赖（仅评估，无可视化）：**
```bash
pip install numpy scikit-learn rapidfuzz
```

**可视化依赖：**
```bash
pip install matplotlib seaborn pandas openpyxl
```

---

## 🎯 实际应用场景

### 场景1：模型选型
- 查看**对比柱状图**快速识别综合质量最高的模型
- 查看**雷达图**了解各模型的特性
- 导出**Excel表格**生成正式报告

### 场景2：质量把关
- 查看**质量分布图**了解低质量三元组比例
- 使用详细结果JSON过滤 `_qc_overall < 0.4` 的三元组
- 重新运行抽取或调整参数

### 场景3：性能诊断
- 查看**散点图**识别异常（高支持度但低一致性）
- 分析原因：可能是schema不匹配、证据不完整等
- 针对性优化

### 场景4：横向对比
- 查看**热力图**全面对比所有模型
- 导出Excel用于团队分享
- 生成PNG图表用于PPT演示

---

## 📁 输出文件示例

运行一次评估后，`data/output/quality_check_results/` 目录内容：

```
quality_check_results/
├── quality_check_report_20251011_120000.json          # JSON报告
├── quality_check_summary_20251011_120000.md           # Markdown摘要
├── quality_comparison_bars_20251011_120000.png        # 柱状图
├── quality_radar_20251011_120000.png                  # 雷达图
├── quality_distribution_20251011_120000.png           # 质量分布图
├── quality_scatter_20251011_120000.png                # 散点图
├── quality_heatmap_20251011_120000.png                # 热力图
├── quality_comparison_20251011_120000.xlsx            # Excel表格
├── deepseek_quality_details_20251011_120000.json      # deepseek详细结果
├── gemini-2.5-flash_quality_details_20251011_120000.json
└── gpt-4.1_quality_details_20251011_120000.json
```

---

## ⚠️ 注意事项

1. **依赖缺失时**：
   - 如果matplotlib/seaborn未安装，会跳过可视化但不影响评估
   - 终端会提示安装命令和手动运行方式

2. **字体问题**（Windows中文）：
   - 脚本已配置SimHei、Microsoft YaHei等中文字体
   - 如果乱码，可修改 `visualize_quality.py` 第30行字体配置

3. **大规模数据**：
   - 图表绘制可能需要数秒时间
   - Excel导出对内存有要求（数千三元组通常没问题）

---

## 🎨 自定义可视化

如需自定义图表样式，编辑 `visualize_quality.py`：

```python
# 修改图表尺寸
fig, ax = plt.subplots(figsize=(12, 6))  # 默认12x6

# 修改颜色方案
colors = ['#3498db', '#2ecc71', '#e74c3c']  # 自定义颜色

# 修改DPI（清晰度）
plt.savefig(output_path, dpi=300)  # 默认300 DPI
```

---

## 📊 可视化效果预览

所有图表均为高分辨率PNG（300 DPI），适合：
- 📄 学术论文插图
- 📊 技术报告配图
- 🎥 PPT演示
- 📱 在线分享

支持Excel的格式：
- 📈 条件格式（可自行添加）
- 📊 数据透视表
- 🔍 筛选和排序

---

## ✅ 总结

通过添加可视化功能，质量评估模块现在提供：

1. **全面性**: 5种图表 + Excel表格，覆盖所有分析需求
2. **易用性**: 一键生成所有可视化，无需手动操作
3. **专业性**: 高分辨率输出，适合正式场合
4. **灵活性**: 自动集成或独立运行，依赖缺失时降级
5. **兼容性**: Windows/Linux/Mac全平台支持

现在可以快速、直观地对比不同模型的三元组抽取质量！
